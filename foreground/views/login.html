<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>登录页面</title>
  <link rel="stylesheet" href="../lib/layui/css/layui.css">
  <link rel="stylesheet" href="../css/base.css">
  <link rel="stylesheet" href="../css/form.css">
  <script src="../lib/jquery.js"></script>
   <!-- <link rel="stylesheet" href="path/to/layui.css" media="all"> -->
<script src="../lib/layui/layui.js"></script>

</head>

<body>
  <div class="header container">登录页面</div>
  <form id="login-container">
    <span class="error">用户名或密码错误！</span>
    <label>
      用户名： <input type="text" id="username" placeholder="请输入用户名" class="username">
    </label>
    <label>
      密&nbsp;&nbsp;&nbsp;码： <input type="text" id="password" placeholder="请输入密码" class="password">
    </label>
    <p>还没账号，<a href="./register.html">去注册</a></p>
    <button type="submit">登录</button>
  </form>
</body>
<script src="../lib/axios.js"></script>
<script>
   console.log(axios);
  $(document).ready(function () {
    console.log(123);
   
    // 当表单提交时
    $("#login-container").submit(function (event) {
      console.log(123);
      event.preventDefault(); // 阻止表单默认提交行为

      // 获取用户名和密码输入框的值
      var username = $("#username").val();
      var password = $("#password").val();

      // 验证用户名和密码是否为空
      if (username.trim() === "" || password.trim() === "") {
        layer.msg('请输入用户名！', {icon: 7, time: 1000});
        return;
      } else if (password.trim() === "") {
        layer.msg('请输入密码', {icon: 7, time: 1000});
        return;
      }
      axios({
        method: "post",
        url: "http://localhost:9000/users/login",
        data:{
        username:username,
        password: password
      },
      headers:{
        'content-type':"application/json"
      }
      }).then(function (res) { 
        if(res.data.code == 5) {
          if(res.data.message == '参数username格式错误'){
            layer.msg('账号必须为3-11位的字母或数字', {icon: 7, time: 1000});
      
          } else {
            layer.msg('密码长度在6到12位', {icon: 7, time: 1000});
        
        } 
        }else if(res.data.code == 1) {
          layer.msg('登录成功', {icon: 6, time: 1000});  
          console.log();
           sessionStorage.setItem('token',res.data.token)
          localStorage.setItem('userInfo',JSON.stringify(res.data.user))
          window.location.href='index.html';
        } else {
          layer.msg(res.data.message, {icon: 7, time: 1000});  
        }
        console.log(res);
      })
    });
  });
</script>

</html>